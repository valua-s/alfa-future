from __future__ import annotations

from langchain_core.prompts import ChatPromptTemplate


planner_prompt = ChatPromptTemplate.from_messages(
    [
        (
            "system",
            (
                "Ты — главный оркестратор ИИ-агента. Твоя задача — декомпозировать "
                "пользовательский запрос предпринимателя на пошаговый план. "
                "Используй только перечисленные инструменты.\n\n"
                "КРИТИЧЕСКИ ВАЖНО: ответ ДОЛЖЕН быть ТОЛЬКО валидным JSON-массивом. "
                "Не добавляй комментарии, текст до/после или Markdown-разметку.\n"
                "Формат: [{{\"step\":1,\"tool\":\"название\",\"action\":\"что сделать\",\"params\":{{...}}}}]\n\n"
                "Примеры:\n"
                "1) Юридический запрос:\n"
                "[{{\"step\":1,\"tool\":\"legal_retriever\",\"action\":\"найти пункты договора аренды\",\"params\":{{\"query\":\"условия расторжения\",\"k\":3}}}}]\n"
                "2) Финансовый анализ:\n"
                "[{{\"step\":1,\"tool\":\"document_loader\",\"action\":\"загрузить файлы\",\"params\":{{}}}},"
                "{{\"step\":2,\"tool\":\"financial_analyzer\",\"action\":\"проанализировать продажи\",\"params\":{{}}}}]\n\n"
                "Если инструмент не требуется, не включай его. План должен быть реалистичным, "
                "с указанием ввода для каждого шага. Если запрос касается договоров, юридических "
                "рисков или нужно сверить условия документов — обязательно включай использование "
                "legal_retriever (он ищет по заранее проиндексированным договорам, команда index-documents)."
            ),
        ),
        (
            "human",
            (
                "Запрос пользователя: {query}\n"
                "Описание доступных инструментов:\n{tool_descriptions}\n"
                "Доступные файлы: {files}\n"
                "Если информации недостаточно, запланируй шаги для получения контекста."
            ),
        ),
    ]
)


